<!DOCTYPE html>
<html>
<head>
    <style>
		body {
			margin: 20px 20px;
        }
		table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
			border: 1px solid #ddd;
        }
        td {
            border: 0px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
		    /* border: 0px solid #ddd; */
            padding: 12px;
			text-align: center;
			border-bottom: 1px solid #ddd;
            background-color: #f2f2f2;
        }
        /* 修复列宽设置 */
        th:nth-child(1), td:nth-child(1) { width: 12%; }
        th:nth-child(2), td:nth-child(2) { width: 35%; }
        th:nth-child(3), td:nth-child(3) { width: 15%; }
        th:nth-child(4), td:nth-child(4) { width: 15%; }
        th:nth-child(5), td:nth-child(5) { width: 15%; }
        th:nth-child(6), td:nth-child(6) { width: 8%; }
        
        /* 对齐修复 */
        td:nth-child(3),
        td:nth-child(4),
        td:nth-child(5) {
            text-align: right;
            padding-right: 25px;
        }
		td:nth-child(6) {
            text-align: center;
			border-left: 1px solid #ddd;
        }
        input[type="number"],
        .right-align {
            text-align: right;
            width: 95%;
            padding: 8px;
        }
        input[type="text"] {
            width: 95%;
            padding: 8px;
        }
        .total {
            font-size: 18px;
            font-weight: bold;
            margin-top: 20px;
            text-align: right;
            padding-right: 225px;
        }
        button {
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            opacity: 0.9;
        }
        .export-btn {
            background-color: #2196F3;
        }
    </style>
</head>
<body>
    <div>
        <button onclick="addNewRow()">添加新行</button>
        <button class="export-btn" onclick="exportConfig()">导出配置</button>
        <button class="export-btn" onclick="document.getElementById('fileInput').click()">导入配置</button>
        <input type="file" id="fileInput" hidden accept=".json" onchange="importConfig(this)">
    </div>

    <table id="componentsTable">
        <thead>
            <tr>
                <th>组件</th>
                <th>型号</th>
                <th>平台</th>
                <th>数量</th>
                <th>价格</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="text" placeholder=""></td>
                <td><input type="text" placeholder=""></td>
                <td><input type="text" class="right-align" placeholder=""></td>
                <td><input type="number" min="0" value="1"></td>
                <td><input type="number" class="price" min="0" step="1"></td>
                <td><button onclick="deleteRow(this)">删除</button></td>
            </tr>
        </tbody>
    </table>

    <div class="total">总价：￥<span id="totalPrice">0.00</span></div>

    <script>
        // 修复后的JavaScript代码
        function addNewRow() {
            const tbody = document.querySelector('#componentsTable tbody');
            const newRow = document.createElement('tr');
            
            newRow.innerHTML = `
                <td><input type="text" placeholder=""></td>
                <td><input type="text" placeholder=""></td>
                <td><input type="text" class="right-align" placeholder=""></td>
                <td><input type="number" min="0" value="1"></td>
                <td><input type="number" class="price" min="0" step="1"></td>
                <td><button onclick="deleteRow(this)">删除</button></td>
            `;

            tbody.appendChild(newRow);
            addPriceListeners(newRow);
        }

        function deleteRow(btn) {
            const row = btn.closest('tr');
            row.parentNode.removeChild(row);
            calculateTotal();
        }

        function calculateTotal() {
            const prices = document.querySelectorAll('.price');
            let total = 0;
            
            prices.forEach(input => {
                const quantity = input.closest('tr').querySelector('input[type="number"]:not(.price)').value;
                total += parseFloat(input.value || 0) * parseInt(quantity || 1);
            });
            
            document.getElementById('totalPrice').textContent = total.toFixed(2);
        }

        function addPriceListeners(row) {
            const inputs = row.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', calculateTotal);
            });
        }

        // 导出/导入功能保持不变
        function exportConfig() {
            const config = {
                components: [],
                total: document.getElementById('totalPrice').textContent,
                timestamp: new Date().toISOString()
            };

            document.querySelectorAll('#componentsTable tbody tr').forEach(row => {
                config.components.push({
                    type: row.cells[0].querySelector('input').value,
                    model: row.cells[1].querySelector('input').value,
                    description: row.cells[2].querySelector('input').value,
                    quantity: row.cells[3].querySelector('input').value,
                    price: row.cells[4].querySelector('input').value
                });
            });

            const blob = new Blob([JSON.stringify(config, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `pc-config-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importConfig(fileInput) {
            const file = fileInput.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const config = JSON.parse(e.target.result);
                    const tbody = document.querySelector('#componentsTable tbody');
                    tbody.innerHTML = '';

                    config.components.forEach(component => {
                        const newRow = document.createElement('tr');
                        newRow.innerHTML = `
                            <td><input type="text" value="${component.type || ''}"></td>
                            <td><input type="text" value="${component.model || ''}"></td>
                            <td><input type="text" class="right-align" value="${component.description || ''}"></td>
                            <td><input type="number" min="0" value="${component.quantity || 0}"></td>
                            <td><input type="number" class="price" min="0" step="1" value="${component.price || 0}"></td>
                            <td><button onclick="deleteRow(this)">删除</button></td>
                        `;
                        tbody.appendChild(newRow);
                        addPriceListeners(newRow);
                    });

                    calculateTotal();
                } catch (error) {
                    alert('配置文件解析失败: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // 初始化事件监听
        document.querySelectorAll('#componentsTable tbody tr').forEach(row => {
            addPriceListeners(row);
        });
    </script>
</body>
</html>
